{% extends "pages/communities/community_layout.html" %}
{% from "components/post_reaction_button.jinja" import post_reaction_button with context %}
{% from "components/dropdown.jinja" import dropdown with context %}
{% from "components/community_comment.jinja" import community_comment with context %}

{% from "pages/communities/community_aside.html" import community_aside with context %}


{% block title %}Dungeon - Communities{% endblock %}

{% block scripts %}
    <script>document.title = 'Dungeon - Communities'</script>
    <script src="{{ url_for('static', path='js/dropdown.js') }}" defer></script>
    <script src="{{ url_for('static', path='js/create_comment.js') }}" defer></script>
{% endblock %}

{% block main_body_main_content %}

    <div
        class="
            px-[1em] [@media(min-width:480px)]:px-[2em] py-[1em] w-[100%]
            transition-all duration-[200ms] border-b-[1px] border-b-gray-800
        "
    >
        <section class="w-[100%] flex flex-row justify-start items-center gap-[0.5em]">
            <a
                href="{{ url_for('library') }}"
                class="
                    text-white h-[3rem] aspect-[1/1] rounded-[50%]
                "
                style="
                    background-image: url('{{ url_for('assets', path='library.png') }}');
                    background-size: 75%;
                    background-position: center;
                    background-repeat: no-repeat;
                "
            >
            </a>
            <div class="flex-1 flex flex-col justify-start items-start">
                <span class="text-white text-[1rem] font-bold">{{ community_post.first_name }} {{ community_post.last_name}}</span>
                <span class="text-gray-400 text-[0.75rem] font-bold font-[cursive]"><span>Community:</span> <span class="px-[0.75em] text-[0.75em] bg-blue-500 rounded-[1rem] text-white -translate-y-[25%]">Analytics</span></span>
            </div>
        </section>
        <section class="py-[1em] flex flex-col justify-start items-start gap-[1em]">
            <header class="text-white font-bold text-lg sm:text-xl font-roboto">{{ community_post.title }}</header>
            <div class="flex flex-row justify-start items-center gap-[1em] flex-wrap">
                {% for tag in community_post.tags %}
                    <span
                        class="
                            px-2 py-1 rounded-[1rem] text-white font-inter text-xs font-bold
                        "
                        style="
                            background-color: rgb(65, 59, 255);
                        "
                    >
                        {{ tag }}
                    </span>
                {% endfor %}
            </div>
            <article
                class="
                    text-sm text-gray-400 break-words text-wrap line-clamp-5 whitespace-pre-wrap
                "
            >{{ markdown_to_html(community_post.content) | safe }}</article>
            <span class="text-blue-700 hover:underline hover:text-blue-500 hover:cursor-pointer">Read more...</span>
        </section>
        <section class="w-[100%] flex flex-row justify-start items-center gap-[1em]">
            {{ post_reaction_button(
                reaction_name='like',
                icon_path='like.png',
                icon_coordinates=('50%', '40%'),
                reaction_value=community_post.likes
            ) }}
            {{ post_reaction_button(
                reaction_name='dislike',
                icon_path='dislike.png',
                icon_coordinates=('50%', '75%'),
                reaction_value=community_post.dislikes
            ) }}
        </section>            
    </div>

    {% block community_post_comment_section %}

    <section class="create_comment flex flex-col justify-stretch items-stretch mt-[1em] mx-[2em]">
        <textarea
            class="
                outline-none w-full rounded-[1rem] bg-gray-800 bg-opacity-50 text-white p-[1em]
                text-sm overflow-hidden min-h-[5rem] h-[5rem]
            "
            placeholder="Create a comment..."
            ></textarea>
            <div
                class="
                    comment_configs hidden
                    self-end w-full h-[3em] bg-gray-800 bg-opacity-50
                    flex-row justify-stretch items-stretch gap-[1em]
                    rounded-b-[1rem] p-[0.5em] border-t-[1px] border-t-gray-800
                "
            >
                <button
                    class="
                        comment_submit 
                        ml-auto mr-0 bg-blue-500 text-white font-bold text-sm rounded-[1rem] px-[1em]
                        transition-all duration-[200ms] hover:bg-blue-800 
                    "
                    data-post-id="{{ community_post.id }}"
                    data-community-title="{{ community_post.community_title }}"
                >
                    Submit
                </button>
                <button
                    class="
                        comment_cancel
                        bg-red-500 text-white font-bold text-sm rounded-[1rem] px-[1em]
                        transition-all duration-[200ms] hover:bg-red-800 
                    "
                >
                    Cancel
                </button>
            </div>
    </section>

    {{ dropdown(class_names='mx-[2em] mt-[2em]') }}

    {% block community_post_comments %}
        {% for comment in community_comments %}
            {{ community_comment(comment) }}
        {% endfor %}
    {% endblock %}

    {% endblock %}

{% endblock %}